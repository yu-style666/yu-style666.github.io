<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>redux | Yu_FL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="å‰è¨€ å‚è€ƒï¼šhttps://www.yuque.com/fe9/basic/cgkg56  è®°å¾—å¼€å§‹æ¥è§¦ react æŠ€æœ¯æ ˆçš„æ—¶å€™ï¼Œæœ€éš¾ç†è§£çš„åœ°æ–¹å°±æ˜¯ reduxã€‚å…¨æ˜¯æ–°åè¯ï¼šreducerã€storeã€dispatchã€middleware ç­‰ç­‰ï¼Œæˆ‘å°±ç†è§£ state ä¸€ä¸ªåè¯ã€‚ ç½‘ä¸Šæ‰¾çš„ redux æ–‡ç« ï¼Œè¦ä¸æœ‰ä¸€æœ¬ä¹¦çš„åšåº¦ï¼Œè¦ä¸å¾ˆç„ä¹ï¼Œæ™¦æ¶©éš¾æ‡‚ï¼Œè¶Šçœ‹è¶Šè§‰å¾—éš¾ï¼Œè¶Šçœ‹è¶Šæ€•ï¼Œä¿¡å¿ƒéƒ½æ²¡æœ‰äº†ï¼ èŠ±äº†å¾ˆ">
<meta property="og:type" content="article">
<meta property="og:title" content="redux">
<meta property="og:url" content="http://yoursite.com/2019/04/28/redux/index.html">
<meta property="og:site_name" content="Yu_FL">
<meta property="og:description" content="å‰è¨€ å‚è€ƒï¼šhttps://www.yuque.com/fe9/basic/cgkg56  è®°å¾—å¼€å§‹æ¥è§¦ react æŠ€æœ¯æ ˆçš„æ—¶å€™ï¼Œæœ€éš¾ç†è§£çš„åœ°æ–¹å°±æ˜¯ reduxã€‚å…¨æ˜¯æ–°åè¯ï¼šreducerã€storeã€dispatchã€middleware ç­‰ç­‰ï¼Œæˆ‘å°±ç†è§£ state ä¸€ä¸ªåè¯ã€‚ ç½‘ä¸Šæ‰¾çš„ redux æ–‡ç« ï¼Œè¦ä¸æœ‰ä¸€æœ¬ä¹¦çš„åšåº¦ï¼Œè¦ä¸å¾ˆç„ä¹ï¼Œæ™¦æ¶©éš¾æ‡‚ï¼Œè¶Šçœ‹è¶Šè§‰å¾—éš¾ï¼Œè¶Šçœ‹è¶Šæ€•ï¼Œä¿¡å¿ƒéƒ½æ²¡æœ‰äº†ï¼ èŠ±äº†å¾ˆ">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2018/png/189350/1541937499061-993cb988-010f-4419-b23e-7482985a66f5.png">
<meta property="og:updated_time" content="2019-06-03T07:15:32.811Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redux">
<meta name="twitter:description" content="å‰è¨€ å‚è€ƒï¼šhttps://www.yuque.com/fe9/basic/cgkg56  è®°å¾—å¼€å§‹æ¥è§¦ react æŠ€æœ¯æ ˆçš„æ—¶å€™ï¼Œæœ€éš¾ç†è§£çš„åœ°æ–¹å°±æ˜¯ reduxã€‚å…¨æ˜¯æ–°åè¯ï¼šreducerã€storeã€dispatchã€middleware ç­‰ç­‰ï¼Œæˆ‘å°±ç†è§£ state ä¸€ä¸ªåè¯ã€‚ ç½‘ä¸Šæ‰¾çš„ redux æ–‡ç« ï¼Œè¦ä¸æœ‰ä¸€æœ¬ä¹¦çš„åšåº¦ï¼Œè¦ä¸å¾ˆç„ä¹ï¼Œæ™¦æ¶©éš¾æ‡‚ï¼Œè¶Šçœ‹è¶Šè§‰å¾—éš¾ï¼Œè¶Šçœ‹è¶Šæ€•ï¼Œä¿¡å¿ƒéƒ½æ²¡æœ‰äº†ï¼ èŠ±äº†å¾ˆ">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2018/png/189350/1541937499061-993cb988-010f-4419-b23e-7482985a66f5.png">
  
    <link rel="alternate" href="/atom.xml" title="Yu_FL" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Yu_FL</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">æŠ€æœ¯æ²‰æ·€</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-redux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/28/redux/" class="article-date">
  <time datetime="2019-04-28T01:07:30.743Z" itemprop="datePublished">2019-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      redux
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote>
<p>å‚è€ƒï¼š<a href="https://www.yuque.com/fe9/basic/cgkg56" target="_blank" rel="noopener">https://www.yuque.com/fe9/basic/cgkg56</a></p>
</blockquote>
<p>è®°å¾—å¼€å§‹æ¥è§¦ react æŠ€æœ¯æ ˆçš„æ—¶å€™ï¼Œæœ€éš¾ç†è§£çš„åœ°æ–¹å°±æ˜¯ reduxã€‚å…¨æ˜¯æ–°åè¯ï¼šreducerã€storeã€dispatchã€middleware ç­‰ç­‰ï¼Œæˆ‘å°±ç†è§£ state ä¸€ä¸ªåè¯ã€‚</p>
<p>ç½‘ä¸Šæ‰¾çš„ redux æ–‡ç« ï¼Œè¦ä¸æœ‰ä¸€æœ¬ä¹¦çš„åšåº¦ï¼Œè¦ä¸å¾ˆç„ä¹ï¼Œæ™¦æ¶©éš¾æ‡‚ï¼Œè¶Šçœ‹è¶Šè§‰å¾—éš¾ï¼Œè¶Šçœ‹è¶Šæ€•ï¼Œä¿¡å¿ƒéƒ½æ²¡æœ‰äº†ï¼</p>
<p>èŠ±äº†å¾ˆé•¿æ—¶é—´ç†Ÿæ‚‰ reduxï¼Œæ…¢æ…¢çš„å‘ç°å®ƒå…¶å®çœŸçš„å¾ˆç®€å•ã€‚æœ¬ç« ä¸ä¼šæŠŠ redux çš„å„ç§æ¦‚å¿µï¼Œåè¯è§£é‡Šä¸€éï¼Œè¿™æ ·å’Œå…¶ä»–æ•™ç¨‹æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œæ²¡æœ‰å¤ªå¤§æ„ä¹‰ã€‚æˆ‘ä¼šå¸¦å¤§å®¶ä»é›¶å®ç°ä¸€ä¸ªå®Œæ•´çš„ reduxï¼Œè®©å¤§å®¶çŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p>
<p>å¼€å§‹å‰ï¼Œä½ å¿…é¡»çŸ¥é“ä¸€äº›äº‹æƒ…ï¼š</p>
<ul>
<li><p>redux å’Œ react æ²¡æœ‰å…³ç³»ï¼Œredux å¯ä»¥ç”¨åœ¨ä»»ä½•æ¡†æ¶ä¸­ï¼Œå¿˜æ‰ reactã€‚</p>
</li>
<li><p>connect ä¸å±äº reduxï¼Œå®ƒå…¶å®å±äº react-reduxï¼Œè¯·å…ˆå¿˜æ‰å®ƒï¼Œä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šä»‹ç»å®ƒã€‚</p>
</li>
<li><p>è¯·ä¸€å®šå…ˆå¿˜è®° reducerã€storeã€dispatchã€middleware ç­‰ç­‰è¿™äº›åè¯ã€‚</p>
</li>
<li><p>redux æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨ã€‚</p>
</li>
</ul>
<p>Letâ€™s Goï¼</p>
<hr>
<h1 id="ç®€å•çš„çŠ¶æ€ç®¡ç†å™¨"><a href="#ç®€å•çš„çŠ¶æ€ç®¡ç†å™¨" class="headerlink" title="ç®€å•çš„çŠ¶æ€ç®¡ç†å™¨"></a>ç®€å•çš„çŠ¶æ€ç®¡ç†å™¨</h1><blockquote>
<p>å‚è€ƒï¼š<a href="https://www.yuque.com/fe9/basic/lp9r6k" target="_blank" rel="noopener">https://www.yuque.com/fe9/basic/lp9r6k</a></p>
</blockquote>
<p>redux æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨ï¼Œé‚£ä»€ä¹ˆæ˜¯çŠ¶æ€å‘¢ï¼ŸçŠ¶æ€å°±æ˜¯æ•°æ®ï¼Œæ¯”å¦‚è®¡æ•°å™¨ä¸­çš„ countã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> state = &#123;</span><br><span class="line">  count: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ä½¿ç”¨ä¸‹çŠ¶æ€</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(state.count);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹çŠ¶æ€</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state.count = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å®ç°äº†çŠ¶æ€ï¼ˆè®¡æ•°ï¼‰çš„ä¿®æ”¹å’Œä½¿ç”¨äº†ã€‚</p>
<blockquote>
<p>è¯»è€…ï¼šä½ å½“æˆ‘å‚»å—ï¼Ÿä½ è¯´çš„è¿™ä¸ªè°ä¸çŸ¥é“ï¼Ÿæ¶ä½ ğŸ‘Šï¼</p>
<p>ç¬”è€…ï¼šå“å“å“ï¼Œåˆ«æ‰“æˆ‘ï¼æœ‰è¯å¥½å¥½è¯´ï¼redux æ ¸å¿ƒå°±æ˜¯è¿™ä¸ªå‘€ï¼æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ‰©å±•å¼€æ¥å˜›ï¼</p>
</blockquote>
<p>å½“ç„¶ä¸Šé¢çš„æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼šä¿®æ”¹ count ä¹‹åï¼Œä½¿ç”¨ count çš„åœ°æ–¹ä¸èƒ½æ”¶åˆ°é€šçŸ¥ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*------count çš„å‘å¸ƒè®¢é˜…è€…å®è·µ------*/</span></span><br><span class="line"><span class="keyword">let</span> state = &#123;</span><br><span class="line">  count: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [fn1, fn2, ...] è®¢é˜…åˆé›† </span></span><br><span class="line"><span class="keyword">let</span> listeners = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è®¢é˜…*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">  listeners.push(listener);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeCount</span>(<span class="params">count</span>) </span>&#123;</span><br><span class="line">  state.count = count;</span><br><span class="line">  <span class="comment">/*å½“ count æ”¹å˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å»é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…*/</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> listener = listeners[i];</span><br><span class="line">    listener();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥å°è¯•ä½¿ç”¨ä¸‹è¿™ä¸ªç®€å•çš„è®¡æ•°çŠ¶æ€ç®¡ç†å™¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ¥è®¢é˜…ä¸€ä¸‹ï¼Œå½“ count æ”¹å˜çš„æ—¶å€™ï¼Œæˆ‘è¦å®æ—¶è¾“å‡ºæ–°çš„å€¼*/</span></span><br><span class="line">subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(state.count);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹ stateï¼Œå½“ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥å»æ”¹ state äº†ï¼Œæˆ‘ä»¬è¦é€šè¿‡ changeCount æ¥ä¿®æ”¹*/</span></span><br><span class="line">changeCount(<span class="number">2</span>);</span><br><span class="line">changeCount(<span class="number">3</span>);</span><br><span class="line">changeCount(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¿®æ”¹ count çš„æ—¶å€™ï¼Œä¼šè¾“å‡ºç›¸åº”çš„ count å€¼ã€‚</p>
<p>ç°åœ¨æœ‰ä¸¤ä¸ªæ–°çš„é—®é¢˜æ‘†åœ¨æˆ‘ä»¬é¢å‰</p>
<ul>
<li><p>è¿™ä¸ªçŠ¶æ€ç®¡ç†å™¨åªèƒ½ç®¡ç† countï¼Œä¸é€šç”¨</p>
</li>
<li><p>å…¬å…±çš„ä»£ç è¦å°è£…èµ·æ¥</p>
</li>
</ul>
<p>æˆ‘ä»¬å°è¯•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒæŠŠå…¬å…±çš„ä»£ç å°è£…èµ·æ¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = <span class="function"><span class="keyword">function</span> (<span class="params">initState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> state = initState;</span><br><span class="line">  <span class="keyword">let</span> listeners = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*è®¢é˜…*/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">    listeners.push(listener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">changeState</span>(<span class="params">newState</span>) </span>&#123;</span><br><span class="line">    state = newState;</span><br><span class="line">    <span class="comment">/*é€šçŸ¥*/</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> listener = listeners[i];</span><br><span class="line">      listener();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    subscribe,</span><br><span class="line">    changeState,</span><br><span class="line">    getState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ä½¿ç”¨è¿™ä¸ªçŠ¶æ€ç®¡ç†å™¨ç®¡ç†å¤šä¸ªçŠ¶æ€ counter å’Œ info è¯•è¯•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> initState = &#123;</span><br><span class="line">  counter: &#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  info: &#123;</span><br><span class="line">    name: <span class="string">''</span>,</span><br><span class="line">    description: <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(initState);</span><br><span class="line"></span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> state = store.getState();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;state.info.name&#125;</span>ï¼š<span class="subst">$&#123;state.info.description&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> state = store.getState();</span><br><span class="line">  <span class="built_in">console</span>.log(state.counter.count);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  ...store.getState(),</span><br><span class="line">  counter: &#123;</span><br><span class="line">    count: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  ...store.getState(),</span><br><span class="line">  info: &#123;</span><br><span class="line">    name: <span class="string">'å‰ç«¯ä¹éƒ¨'</span>,</span><br><span class="line">    description: <span class="string">'æˆ‘ä»¬éƒ½æ˜¯å‰ç«¯çˆ±å¥½è€…ï¼'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªç®€å•çš„çŠ¶æ€ç®¡ç†å™¨ã€‚</p>
<p>è¿™é‡Œéœ€è¦ç†è§£çš„æ˜¯ <code>createStore</code>ï¼Œæä¾›äº† <code>changeState</code>ï¼Œ<code>getState</code>ï¼Œ<code>subscribe</code> ä¸‰ä¸ªèƒ½åŠ›ã€‚</p>
<hr>
<h1 id="æœ‰è®¡åˆ’çš„çŠ¶æ€ç®¡ç†å™¨"><a href="#æœ‰è®¡åˆ’çš„çŠ¶æ€ç®¡ç†å™¨" class="headerlink" title="æœ‰è®¡åˆ’çš„çŠ¶æ€ç®¡ç†å™¨"></a>æœ‰è®¡åˆ’çš„çŠ¶æ€ç®¡ç†å™¨</h1><p>æˆ‘ä»¬ç”¨ä¸Šé¢çš„çŠ¶æ€ç®¡ç†å™¨æ¥å®ç°ä¸€ä¸ªè‡ªå¢ï¼Œè‡ªå‡çš„è®¡æ•°å™¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> initState = &#123;</span><br><span class="line">  count: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> store = createStore(initState);</span><br><span class="line"></span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> state = store.getState();</span><br><span class="line">  <span class="built_in">console</span>.log(state.count);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*è‡ªå¢*/</span></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  count: store.getState().count + <span class="number">1</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*è‡ªå‡*/</span></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  count: store.getState().count - <span class="number">1</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*æˆ‘æƒ³éšä¾¿æ”¹*/</span></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  count: <span class="string">'abc'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ä½ ä¸€å®šå‘ç°äº†é—®é¢˜ï¼Œcount è¢«æ”¹æˆäº†å­—ç¬¦ä¸² <code>abc</code>ï¼Œå› ä¸ºæˆ‘ä»¬å¯¹ count çš„ä¿®æ”¹æ²¡æœ‰ä»»ä½•çº¦æŸï¼Œä»»ä½•åœ°æ–¹ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦çº¦æŸï¼Œä¸å…è®¸è®¡åˆ’å¤–çš„ count ä¿®æ”¹ï¼Œæˆ‘ä»¬åªå…è®¸ count è‡ªå¢å’Œè‡ªå‡ä¸¤ç§æ”¹å˜æ–¹å¼ï¼</p>
<p>é‚£æˆ‘ä»¬åˆ†ä¸¤æ­¥æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
<ol>
<li>åˆ¶å®šä¸€ä¸ª state ä¿®æ”¹è®¡åˆ’ï¼Œå‘Šè¯‰ storeï¼Œæˆ‘çš„ä¿®æ”¹è®¡åˆ’æ˜¯ä»€ä¹ˆã€‚</li>
<li>ä¿®æ”¹ store.changeState æ–¹æ³•ï¼Œå‘Šè¯‰å®ƒä¿®æ”¹ state çš„æ—¶å€™ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„è®¡åˆ’ä¿®æ”¹ã€‚</li>
</ol>
<p>æˆ‘ä»¬æ¥è®¾ç½®ä¸€ä¸ª plan å‡½æ•°ï¼Œæ¥æ”¶ç°åœ¨çš„ stateï¼Œå’Œä¸€ä¸ª actionï¼Œè¿”å›ç»è¿‡æ”¹å˜åçš„æ–°çš„ stateã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ³¨æ„ï¼šaction = &#123;type:'',other:''&#125;, action å¿…é¡»æœ‰ä¸€ä¸ª type å±æ€§*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plan</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        count: state.count + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        count: state.count - <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŠŠè¿™ä¸ªè®¡åˆ’å‘Šè¯‰ storeï¼Œstore.changeState ä»¥åæ”¹å˜ state è¦æŒ‰ç…§æˆ‘çš„è®¡åˆ’æ¥æ”¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å¢åŠ ä¸€ä¸ªå‚æ•° plan*/</span></span><br><span class="line"><span class="keyword">const</span> createStore = <span class="function"><span class="keyword">function</span> (<span class="params">plan, initState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> state = initState;</span><br><span class="line">  <span class="keyword">let</span> listeners = [];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">    listeners.push(listener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">changeState</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*è¯·æŒ‰ç…§æˆ‘çš„è®¡åˆ’ä¿®æ”¹ state*/</span>  </span><br><span class="line">    state = plan(state, action);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> listener = listeners[i];</span><br><span class="line">      listener();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    subscribe,</span><br><span class="line">    changeState,</span><br><span class="line">    getState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥å°è¯•ä½¿ç”¨ä¸‹æ–°çš„ createStore æ¥å®ç°è‡ªå¢å’Œè‡ªå‡</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> initState = &#123;</span><br><span class="line">  count: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*æŠŠplanå‡½æ•°*/</span></span><br><span class="line"><span class="keyword">let</span> store = createStore(plan, initState);</span><br><span class="line"></span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> state = store.getState();</span><br><span class="line">  <span class="built_in">console</span>.log(state.count);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*è‡ªå¢*/</span></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  type: <span class="string">'INCREMENT'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*è‡ªå‡*/</span></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  type: <span class="string">'DECREMENT'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*æˆ‘æƒ³éšä¾¿æ”¹ è®¡åˆ’å¤–çš„ä¿®æ”¹æ˜¯æ— æ•ˆçš„ï¼*/</span></span><br><span class="line">store.changeState(&#123;</span><br><span class="line">  count: <span class="string">'abc'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªæœ‰è®¡åˆ’çš„çŠ¶æ€ç®¡ç†å™¨ï¼</p>
<p>æˆ‘ä»¬å•†é‡ä¸€ä¸‹å§ï¼Ÿæˆ‘ä»¬ç»™ plan å’Œ changeState æ”¹ä¸‹åå­—å¥½ä¸å¥½ï¼Ÿ<strong>plan æ”¹æˆ reducerï¼ŒchangeState æ”¹æˆ dispatchï¼</strong>ä¸ç®¡ä½ åŒä¸åŒæ„ï¼Œæˆ‘éƒ½è¦æ¢ï¼Œå› ä¸ºæ–°åå­—æ¯”è¾ƒå‰å®³ï¼ˆå…¶å®å› ä¸º redux æ˜¯è¿™ä¹ˆå«çš„ï¼‰!</p>
<hr>
<h1 id="reducer-çš„æ‹†åˆ†å’Œåˆå¹¶"><a href="#reducer-çš„æ‹†åˆ†å’Œåˆå¹¶" class="headerlink" title="reducer çš„æ‹†åˆ†å’Œåˆå¹¶"></a>reducer çš„æ‹†åˆ†å’Œåˆå¹¶</h1><p>è¿™ä¸€å°èŠ‚æˆ‘ä»¬æ¥å¤„ç†ä¸‹ reducer çš„é—®é¢˜ã€‚å•¥é—®é¢˜ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ reducer æ˜¯ä¸€ä¸ªè®¡åˆ’å‡½æ•°ï¼Œæ¥æ”¶è€çš„ stateï¼ŒæŒ‰è®¡åˆ’è¿”å›æ–°çš„ stateã€‚é‚£æˆ‘ä»¬é¡¹ç›®ä¸­ï¼Œæœ‰å¤§é‡çš„ stateï¼Œæ¯ä¸ª state éƒ½éœ€è¦è®¡åˆ’å‡½æ•°ï¼Œå¦‚æœå…¨éƒ¨å†™åœ¨ä¸€èµ·ä¼šæ˜¯å•¥æ ·å­å‘¢ï¼Ÿ</p>
<p>æ‰€æœ‰çš„è®¡åˆ’å†™åœ¨ä¸€ä¸ª reducer å‡½æ•°é‡Œé¢ï¼Œä¼šå¯¼è‡´ reducer å‡½æ•°åŠå…¶åºå¤§å¤æ‚ã€‚æŒ‰ç»éªŒæ¥è¯´ï¼Œæˆ‘ä»¬è‚¯å®šä¼šæŒ‰ç»„ä»¶ç»´åº¦æ¥æ‹†åˆ†å‡ºå¾ˆå¤šä¸ª reducer å‡½æ•°ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå‡½æ•°æ¥æŠŠä»–ä»¬åˆå¹¶èµ·æ¥ã€‚</p>
<p>æˆ‘ä»¬æ¥ç®¡ç†ä¸¤ä¸ª stateï¼Œä¸€ä¸ª counterï¼Œä¸€ä¸ª infoã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> state = &#123;</span><br><span class="line">  counter: &#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  info: &#123;</span><br><span class="line">    name: <span class="string">'å‰ç«¯ä¹éƒ¨'</span>,</span><br><span class="line">    description: <span class="string">'æˆ‘ä»¬éƒ½æ˜¯å‰ç«¯çˆ±å¥½è€…ï¼'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»–ä»¬å„è‡ªçš„ reducer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*counterReducer, ä¸€ä¸ªå­reducer*/</span></span><br><span class="line"><span class="comment">/*æ³¨æ„ï¼šcounterReducer æ¥æ”¶çš„ state æ˜¯ state.counter*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">counterReducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        count: state.count + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        count: state.count - <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*InfoReducerï¼Œä¸€ä¸ªå­reducer*/</span></span><br><span class="line"><span class="comment">/*æ³¨æ„ï¼šInfoReducer æ¥æ”¶çš„ state æ˜¯ state.info*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InfoReducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'SET_NAME'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        name: action.name</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'SET_DESCRIPTION'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        description: action.description</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬ç”¨ combineReducers å‡½æ•°æ¥æŠŠå¤šä¸ª reducer å‡½æ•°åˆå¹¶æˆä¸€ä¸ª reducer å‡½æ•°ã€‚å¤§æ¦‚è¿™æ ·ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">    counter: counterReducer,</span><br><span class="line">    info: InfoReducer</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°è¯•å®ç°ä¸‹ combineReducers å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* reducerKeys = ['counter', 'info']*/</span></span><br><span class="line">  <span class="keyword">const</span> reducerKeys = <span class="built_in">Object</span>.keys(reducers)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*è¿”å›åˆå¹¶åçš„æ–°çš„reducerå‡½æ•°*/</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*ç”Ÿæˆçš„æ–°çš„state*/</span></span><br><span class="line">    <span class="keyword">const</span> nextState = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*éå†æ‰§è¡Œæ‰€æœ‰çš„reducersï¼Œæ•´åˆæˆä¸ºä¸€ä¸ªæ–°çš„state*/</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> key = reducerKeys[i]</span><br><span class="line">      <span class="keyword">const</span> reducer = reducers[key]</span><br><span class="line">      <span class="comment">/*ä¹‹å‰çš„ key çš„ state*/</span></span><br><span class="line">      <span class="keyword">const</span> previousStateForKey = state[key]</span><br><span class="line">      <span class="comment">/*æ‰§è¡Œ åˆ† reducerï¼Œè·å¾—æ–°çš„state*/</span></span><br><span class="line">      <span class="keyword">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class="line"></span><br><span class="line">      nextState[key] = nextStateForKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nextState;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥å°è¯•ä¸‹ combineReducers çš„å¨åŠ›å§</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">  info: InfoReducer</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initState = &#123;</span><br><span class="line">  counter: &#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  info: &#123;</span><br><span class="line">    name: <span class="string">'å‰ç«¯ä¹éƒ¨'</span>,</span><br><span class="line">    description: <span class="string">'æˆ‘ä»¬éƒ½æ˜¯å‰ç«¯çˆ±å¥½è€…ï¼'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer, initState);</span><br><span class="line"></span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> state = store.getState();</span><br><span class="line">  <span class="built_in">console</span>.log(state.counter.count, state.info.name, state.info.description);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*è‡ªå¢*/</span></span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'INCREMENT'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¿®æ”¹ name*/</span></span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'SET_NAME'</span>,</span><br><span class="line">  name: <span class="string">'å‰ç«¯ä¹éƒ¨2å·'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="state-çš„æ‹†åˆ†å’Œåˆå¹¶"><a href="#state-çš„æ‹†åˆ†å’Œåˆå¹¶" class="headerlink" title="state çš„æ‹†åˆ†å’Œåˆå¹¶"></a>state çš„æ‹†åˆ†å’Œåˆå¹¶</h1><p>ä¸Šä¸€å°èŠ‚ï¼Œæˆ‘ä»¬æŠŠ reducer æŒ‰ç»„ä»¶ç»´åº¦æ‹†åˆ†äº†ï¼Œé€šè¿‡ combineReducers åˆå¹¶äº†èµ·æ¥ã€‚ä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œ state æˆ‘ä»¬è¿˜æ˜¯å†™åœ¨ä¸€èµ·çš„ï¼Œè¿™æ ·ä¼šé€ æˆ state æ ‘å¾ˆåºå¤§ï¼Œä¸ç›´è§‚ï¼Œå¾ˆéš¾ç»´æŠ¤ã€‚æˆ‘ä»¬éœ€è¦æ‹†åˆ†ï¼Œä¸€ä¸ª stateï¼Œä¸€ä¸ª reducer å†™ä¸€å—ã€‚</p>
<p>è¿™ä¸€å°èŠ‚æ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸å–å…³å­äº†ï¼Œç”¨æ³•å¤§æ¦‚æ˜¯è¿™æ ·ï¼ˆæ³¨æ„æ³¨é‡Šï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* counter è‡ªå·±çš„ state å’Œ reducer å†™åœ¨ä¸€èµ·*/</span></span><br><span class="line"><span class="keyword">let</span> initState = &#123;</span><br><span class="line">  count: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">counterReducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*æ³¨æ„ï¼šå¦‚æœ state æ²¡æœ‰åˆå§‹å€¼ï¼Œé‚£å°±ç»™ä»–åˆå§‹å€¼ï¼ï¼*/</span>  </span><br><span class="line">  <span class="keyword">if</span> (!state) &#123;</span><br><span class="line">      state = initState;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        count: state.count + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:    </span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¿®æ”¹ä¸‹ createStore å‡½æ•°ï¼Œå¢åŠ ä¸€è¡Œ <code>dispatch({ type: Symbol() })</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = <span class="function"><span class="keyword">function</span> (<span class="params">reducer, initState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> state = initState;</span><br><span class="line">  <span class="keyword">let</span> listeners = [];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">    listeners.push(listener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">    state = reducer(state, action);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> listener = listeners[i];</span><br><span class="line">      listener();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* æ³¨æ„ï¼ï¼ï¼åªä¿®æ”¹äº†è¿™é‡Œï¼Œç”¨ä¸€ä¸ªä¸åŒ¹é…ä»»ä½•è®¡åˆ’çš„ typeï¼Œæ¥è·å–åˆå§‹å€¼ */</span></span><br><span class="line">  dispatch(&#123; <span class="attr">type</span>: <span class="built_in">Symbol</span>() &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    subscribe,</span><br><span class="line">    dispatch,</span><br><span class="line">    getState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ€è€ƒä¸‹è¿™è¡Œå¯ä»¥å¸¦æ¥ä»€ä¹ˆæ•ˆæœï¼Ÿ</p>
<ol>
<li>createStore çš„æ—¶å€™ï¼Œç”¨ä¸€ä¸ªä¸åŒ¹é…ä»»ä½• type çš„ actionï¼Œæ¥è§¦å‘ <code>state = reducer(state, action)</code></li>
<li>å› ä¸º action.type ä¸åŒ¹é…ï¼Œæ¯ä¸ªå­ reducer éƒ½ä¼šè¿›åˆ° default é¡¹ï¼Œè¿”å›è‡ªå·±åˆå§‹åŒ–çš„ stateï¼Œè¿™æ ·å°±è·å¾—äº†åˆå§‹åŒ–çš„ state æ ‘äº†ã€‚</li>
</ol>
<p>ä½ å¯ä»¥è¯•è¯•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è¿™é‡Œæ²¡æœ‰ä¼  initState å“¦ */</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"><span class="comment">/*è¿™é‡Œçœ‹çœ‹åˆå§‹åŒ–çš„ state æ˜¯ä»€ä¹ˆ*/</span></span><br><span class="line"><span class="built_in">console</span>.dir(store.getState());</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªä¸ƒä¸ƒå…«å…«çš„ redux å•¦ï¼</p>
<hr>
<h1 id="ä¸­é—´ä»¶-middleware"><a href="#ä¸­é—´ä»¶-middleware" class="headerlink" title="ä¸­é—´ä»¶ middleware"></a>ä¸­é—´ä»¶ middleware</h1><p>ä¸­é—´ä»¶ middleware æ˜¯ redux ä¸­æœ€éš¾ç†è§£çš„åœ°æ–¹ã€‚ä½†æ˜¯æˆ‘æŒ‘æˆ˜ä¸€ä¸‹ç”¨æœ€é€šä¿—çš„è¯­è¨€æ¥è®²æ˜ç™½å®ƒã€‚å¦‚æœä½ çœ‹å®Œè¿™ä¸€å°èŠ‚ï¼Œè¿˜æ²¡æ˜ç™½ä¸­é—´ä»¶æ˜¯ä»€ä¹ˆï¼Œä¸çŸ¥é“å¦‚ä½•å†™ä¸€ä¸ªä¸­é—´ä»¶ï¼Œé‚£å°±æ˜¯æˆ‘çš„é”…äº†ï¼</p>
<p>ä¸­é—´ä»¶æ˜¯å¯¹ dispatch çš„æ‰©å±•ï¼Œæˆ–è€…è¯´é‡å†™ï¼Œå¢å¼º dispatch çš„åŠŸèƒ½ï¼</p>
<h4 id="è®°å½•æ—¥å¿—"><a href="#è®°å½•æ—¥å¿—" class="headerlink" title="è®°å½•æ—¥å¿—"></a>è®°å½•æ—¥å¿—</h4><p>æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹ state çš„æ—¶å€™ï¼Œè®°å½•ä¸‹æ¥ ä¿®æ”¹å‰çš„ state ï¼Œä¸ºä»€ä¹ˆä¿®æ”¹äº†ï¼Œä»¥åŠä¿®æ”¹åçš„ stateã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ store.dispatch æ¥å®ç°ï¼Œç›´æ¥çœ‹ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*é‡å†™äº†store.dispatch*/</span></span><br><span class="line">store.dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this state'</span>, store.getState());</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'action'</span>, action);</span><br><span class="line">  next(action);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ä½¿ç”¨ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'INCREMENT'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ—¥å¿—è¾“å‡ºä¸º</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span> state &#123; <span class="attr">counter</span>: &#123; <span class="attr">count</span>: <span class="number">0</span> &#125; &#125;</span><br><span class="line">action &#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;</span><br><span class="line"><span class="number">1</span></span><br><span class="line">next state &#123; <span class="attr">counter</span>: &#123; <span class="attr">count</span>: <span class="number">1</span> &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªå®Œç¾çš„è®°å½• state ä¿®æ”¹æ—¥å¿—çš„åŠŸèƒ½ï¼</p>
<h4 id="è®°å½•å¼‚å¸¸"><a href="#è®°å½•å¼‚å¸¸" class="headerlink" title="è®°å½•å¼‚å¸¸"></a>è®°å½•å¼‚å¸¸</h4><p>æˆ‘åˆæœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦è®°å½•æ¯æ¬¡æ•°æ®å‡ºé”™çš„åŸå› ï¼Œæˆ‘ä»¬æ‰©å±•ä¸‹ dispatch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch;</span><br><span class="line"></span><br><span class="line">store.dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    next(action);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æŠ¥å‘Š: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ¯æ¬¡ dispatch å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚</p>
<h4 id="å¤šä¸­é—´ä»¶çš„åˆä½œ"><a href="#å¤šä¸­é—´ä»¶çš„åˆä½œ" class="headerlink" title="å¤šä¸­é—´ä»¶çš„åˆä½œ"></a>å¤šä¸­é—´ä»¶çš„åˆä½œ</h4><p>æˆ‘ç°åœ¨æ—¢éœ€è¦è®°å½•æ—¥å¿—ï¼Œåˆéœ€è¦è®°å½•å¼‚å¸¸ï¼Œæ€ä¹ˆåŠï¼Ÿå½“ç„¶å¾ˆç®€å•äº†ï¼Œä¸¤ä¸ªå‡½æ•°åˆèµ·æ¥å‘—ï¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this state'</span>, store.getState());</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'action'</span>, action);</span><br><span class="line">    next(action);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æŠ¥å‘Š: '</span>, err)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåˆæ¥ä¸€ä¸ªéœ€æ±‚æ€ä¹ˆåŠï¼Ÿæ¥ç€æ”¹ dispatch å‡½æ•°ï¼Ÿé‚£å†æ¥10ä¸ªéœ€æ±‚å‘¢ï¼Ÿåˆ°æ—¶å€™ dispatch å‡½æ•°è‚¯å®šåºå¤§æ··ä¹±åˆ°æ— æ³•ç»´æŠ¤äº†ï¼è¿™ä¸ªæ–¹å¼ä¸å¯å–å‘€ï¼</p>
<p>æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•å®ç°æ‰©å±•æ€§å¾ˆå¼ºçš„å¤šä¸­é—´ä»¶åˆä½œæ¨¡å¼ã€‚</p>
<ol>
<li>æˆ‘ä»¬æŠŠ loggerMiddleware æå–å‡ºæ¥</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this state'</span>, store.getState());</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'action'</span>, action);</span><br><span class="line">  next(action);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    loggerMiddleware(action);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æŠ¥å‘Š: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æˆ‘ä»¬æŠŠ exceptionMiddleware æå–å‡ºæ¥</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">/*next(action)*/</span></span><br><span class="line">    loggerMiddleware(action);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æŠ¥å‘Š: '</span>, err)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line">store.dispatch = exceptionMiddleware;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç°åœ¨çš„ä»£ç æœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå°±æ˜¯ exceptionMiddleware é‡Œé¢å†™æ­»äº† loggerMiddlewareï¼Œæˆ‘ä»¬éœ€è¦è®© <code>next(action)</code>å˜æˆåŠ¨æ€çš„ï¼Œéšä¾¿å“ªä¸ªä¸­é—´ä»¶éƒ½å¯ä»¥</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">/*loggerMiddleware(action);*/</span></span><br><span class="line">    next(action);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æŠ¥å‘Š: '</span>, err)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*loggerMiddleware å˜æˆå‚æ•°ä¼ è¿›å»*/</span></span><br><span class="line">store.dispatch = exceptionMiddleware(loggerMiddleware);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åŒæ ·çš„é“ç†ï¼ŒloggerMiddleware é‡Œé¢çš„ next ç°åœ¨æ’ç­‰äº store.dispatchï¼Œå¯¼è‡´ loggerMiddleware é‡Œé¢æ— æ³•æ‰©å±•åˆ«çš„ä¸­é—´ä»¶äº†ï¼æˆ‘ä»¬ä¹ŸæŠŠ next å†™æˆåŠ¨æ€çš„</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this state'</span>, store.getState());</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'action'</span>, action);</span><br><span class="line">  next(action);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æ¢ç´¢å‡ºäº†ä¸€ä¸ªæ‰©å±•æ€§å¾ˆé«˜çš„ä¸­é—´ä»¶åˆä½œæ¨¡å¼ï¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this state'</span>, store.getState());</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'action'</span>, action);</span><br><span class="line">  next(action);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    next(action);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æŠ¥å‘Š: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.dispatch = exceptionMiddleware(loggerMiddleware(next));</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™æˆ‘ä»¬å¼€å¼€å¿ƒå¿ƒçš„æ–°å»ºäº†ä¸€ä¸ª <code>loggerMiddleware.js</code>ï¼Œä¸€ä¸ª<code>exceptionMiddleware.js</code>æ–‡ä»¶ï¼Œæƒ³æŠŠä¸¤ä¸ªä¸­é—´ä»¶ç‹¬ç«‹åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­å»ã€‚ä¼šç¢°åˆ°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p>
<p>loggerMiddleware ä¸­åŒ…å«äº†å¤–éƒ¨å˜é‡ storeï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•æŠŠä¸­é—´ä»¶ç‹¬ç«‹å‡ºå»ã€‚é‚£æˆ‘ä»¬æŠŠ store ä¹Ÿä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ è¿›å»å¥½äº†~</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"><span class="keyword">const</span> next  = store.dispatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loggerMiddleware = <span class="function">(<span class="params">store</span>) =&gt;</span> <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this state'</span>, store.getState());</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'action'</span>, action);</span><br><span class="line">  next(action);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exceptionMiddleware = <span class="function">(<span class="params">store</span>) =&gt;</span> <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    next(action);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æŠ¥å‘Š: '</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger = loggerMiddleware(store);</span><br><span class="line"><span class="keyword">const</span> exception = exceptionMiddleware(store);</span><br><span class="line">store.dispatch = exception(logger(next));</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬çœŸæ­£çš„å®ç°äº†ä¸¤ä¸ªå¯ä»¥ç‹¬ç«‹çš„ä¸­é—´ä»¶å•¦ï¼</p>
<p>ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œåœ¨æ‰“å°æ—¥å¿—ä¹‹å‰è¾“å‡ºå½“å‰çš„æ—¶é—´æˆ³ã€‚ç”¨ä¸­é—´ä»¶æ¥å®ç°ï¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeMiddleware = <span class="function">(<span class="params">store</span>) =&gt;</span> <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'time'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>().getTime());</span><br><span class="line">  next(action);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> time = timeMiddleware(store);</span><br><span class="line">store.dispatch = exception(time(logger(next)));</span><br></pre></td></tr></table></figure>

<h4 id="ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–"><a href="#ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–" class="headerlink" title="ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–"></a>ä¸­é—´ä»¶ä½¿ç”¨æ–¹å¼ä¼˜åŒ–</h4><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»å®Œå…¨å®ç°äº†æ­£ç¡®çš„ä¸­é—´ä»¶ï¼ä½†æ˜¯ä¸­é—´ä»¶çš„ä½¿ç”¨æ–¹å¼ä¸æ˜¯å¾ˆå‹å¥½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loggerMiddleware <span class="keyword">from</span> <span class="string">'./middlewares/loggerMiddleware'</span>;</span><br><span class="line"><span class="keyword">import</span> exceptionMiddleware <span class="keyword">from</span> <span class="string">'./middlewares/exceptionMiddleware'</span>;</span><br><span class="line"><span class="keyword">import</span> timeMiddleware <span class="keyword">from</span> <span class="string">'./middlewares/timeMiddleware'</span>;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"><span class="keyword">const</span> next = store.dispatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger = loggerMiddleware(store);</span><br><span class="line"><span class="keyword">const</span> exception = exceptionMiddleware(store);</span><br><span class="line"><span class="keyword">const</span> time = timeMiddleware(store);</span><br><span class="line">store.dispatch = exception(time(logger(next)));</span><br></pre></td></tr></table></figure>

<p>å…¶å®æˆ‘ä»¬åªéœ€è¦çŸ¥é“ä¸‰ä¸ªä¸­é—´ä»¶ï¼Œå‰©ä¸‹çš„ç»†èŠ‚éƒ½å¯ä»¥å°è£…èµ·æ¥ï¼æˆ‘ä»¬é€šè¿‡æ‰©å±• createStore æ¥å®ç°ï¼</p>
<p>å…ˆæ¥çœ‹çœ‹æœŸæœ›çš„ç”¨æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ¥æ”¶æ—§çš„ createStoreï¼Œè¿”å›æ–°çš„ createStore*/</span></span><br><span class="line"><span class="keyword">const</span> newCreateStore = applyMiddleware(exceptionMiddleware, timeMiddleware, loggerMiddleware)(createStore);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è¿”å›äº†ä¸€ä¸ª dispatch è¢«é‡å†™è¿‡çš„ store*/</span></span><br><span class="line"><span class="keyword">const</span> store = newCreateStore(reducer);</span><br></pre></td></tr></table></figure>

<p>å®ç° applyMiddleware</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> applyMiddleware = <span class="function"><span class="keyword">function</span> (<span class="params">...middlewares</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*è¿”å›ä¸€ä¸ªé‡å†™createStoreçš„æ–¹æ³•*/</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">rewriteCreateStoreFunc</span>(<span class="params">oldCreateStore</span>) </span>&#123;</span><br><span class="line">     <span class="comment">/*è¿”å›é‡å†™åæ–°çš„ createStore*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">newCreateStore</span>(<span class="params">reducer, initState</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*1. ç”Ÿæˆstore*/</span></span><br><span class="line">      <span class="keyword">const</span> store = oldCreateStore(reducer, initState);</span><br><span class="line">      <span class="comment">/*ç»™æ¯ä¸ª middleware ä¼ ä¸‹storeï¼Œç›¸å½“äº const logger = loggerMiddleware(store);*/</span></span><br><span class="line">      <span class="comment">/* const chain = [exception, time, logger]*/</span></span><br><span class="line">      <span class="keyword">const</span> chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(store));</span><br><span class="line">      <span class="keyword">let</span> dispatch = store.dispatch;</span><br><span class="line">      <span class="comment">/* å®ç° exception(time((logger(dispatch))))*/</span></span><br><span class="line">      chain.reverse().map(<span class="function"><span class="params">middleware</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch = middleware(dispatch);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*2. é‡å†™ dispatch*/</span></span><br><span class="line">      store.dispatch = dispatch;</span><br><span class="line">      <span class="keyword">return</span> store;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è®©ç”¨æˆ·ä½“éªŒç¾å¥½"><a href="#è®©ç”¨æˆ·ä½“éªŒç¾å¥½" class="headerlink" title="è®©ç”¨æˆ·ä½“éªŒç¾å¥½"></a>è®©ç”¨æˆ·ä½“éªŒç¾å¥½</h4><p>ç°åœ¨è¿˜æœ‰ä¸ªå°é—®é¢˜ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§ createStore äº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ²¡æœ‰ä¸­é—´ä»¶çš„ createStore*/</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'./redux'</span>;</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, initState);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æœ‰ä¸­é—´ä»¶çš„ createStore*/</span></span><br><span class="line"><span class="keyword">const</span> rewriteCreateStoreFunc = applyMiddleware(exceptionMiddleware, timeMiddleware, loggerMiddleware);</span><br><span class="line"><span class="keyword">const</span> newCreateStore = rewriteCreateStoreFunc(createStore);</span><br><span class="line"><span class="keyword">const</span> store = newCreateStore(reducer, initState);</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è®©ç”¨æˆ·ç”¨èµ·æ¥ç»Ÿä¸€ä¸€äº›ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ä½¿ä»–ä»¬çš„ä½¿ç”¨æ–¹å¼ä¸€è‡´ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹ createStore æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = <span class="function">(<span class="params">reducer, initState, rewriteCreateStoreFunc</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*å¦‚æœæœ‰ rewriteCreateStoreFuncï¼Œé‚£å°±é‡‡ç”¨æ–°çš„ createStore */</span></span><br><span class="line">    <span class="keyword">if</span>(rewriteCreateStoreFunc)&#123;</span><br><span class="line">       <span class="keyword">const</span> newCreateStore =  rewriteCreateStoreFunc(createStore);</span><br><span class="line">       <span class="keyword">return</span> newCreateStore(reducer, initState);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*å¦åˆ™æŒ‰ç…§æ­£å¸¸çš„æµç¨‹èµ°*/</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆçš„ç”¨æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rewriteCreateStoreFunc = applyMiddleware(exceptionMiddleware, timeMiddleware, loggerMiddleware);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, initState, rewriteCreateStoreFunc);</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="é€€è®¢"><a href="#é€€è®¢" class="headerlink" title="é€€è®¢"></a>é€€è®¢</h1><p>ä¸èƒ½é€€è®¢çš„è®¢é˜…éƒ½æ˜¯è€æµæµªï¼æˆ‘ä»¬ä¿®æ”¹ä¸‹ store.subscribe æ–¹æ³•ï¼Œå¢åŠ é€€è®¢åŠŸèƒ½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">  listeners.push(listener);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> index = listeners.indexOf(listener)</span><br><span class="line">    listeners.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> state = store.getState();</span><br><span class="line">  <span class="built_in">console</span>.log(state.counter.count);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*é€€è®¢*/</span></span><br><span class="line">unsubscribe();</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ä¸­é—´ä»¶çš„-store"><a href="#ä¸­é—´ä»¶çš„-store" class="headerlink" title="ä¸­é—´ä»¶çš„ store"></a>ä¸­é—´ä»¶çš„ store</h1><p>ç°åœ¨çš„ä¸­é—´ä»¶æ‹¿åˆ°äº†å®Œæ•´çš„ storeï¼Œä»–ç”šè‡³å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„ subscribe æ–¹æ³•ï¼ŒæŒ‰ç…§æœ€å°å¼€æ”¾ç­–ç•¥ï¼Œæˆ‘ä»¬åªç”¨æŠŠ getState ç»™ä¸­é—´ä»¶å°±å¯ä»¥äº†ï¼å› ä¸ºæˆ‘ä»¬åªå…è®¸ä½ ç”¨ getState æ–¹æ³•ï¼</p>
<p>ä¿®æ”¹ä¸‹ applyMiddleware ä¸­ç»™ä¸­é—´ä»¶ä¼ çš„ store</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*const chain = middlewares.map(middleware =&gt; middleware(store));*/</span></span><br><span class="line"><span class="keyword">const</span> simpleStore = &#123; <span class="attr">getState</span>: store.getState &#125;;</span><br><span class="line"><span class="keyword">const</span> chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(simpleStore));</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h1><p>æˆ‘ä»¬çš„ applyMiddleware ä¸­ï¼ŒæŠŠ  [A, B, C] è½¬æ¢æˆ A(B(C(next)))ï¼Œæ˜¯è¿™æ ·å®ç°çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chain = [A, B, C];</span><br><span class="line"><span class="keyword">let</span> dispatch = store.dispatch;</span><br><span class="line">chain.reverse().map(<span class="function"><span class="params">middleware</span> =&gt;</span> &#123;</span><br><span class="line">   dispatch = middleware(dispatch);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>redux æä¾›äº†ä¸€ä¸ª compose æ–¹å¼ï¼Œå¯ä»¥å¸®æˆ‘ä»¬åšè¿™ä¸ªäº‹æƒ…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chain = [A, B, C];</span><br><span class="line">dispatch = compose(...chain)(store.dispatch)</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸‹ä»–æ˜¯å¦‚ä½•å®ç°çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> a(b(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ compose å‡½æ•°å¯¹äºæ–°äººæ¥è¯´å¯èƒ½æ¯”è¾ƒéš¾ç†è§£ï¼Œä½ åªéœ€è¦ä»–æ˜¯åšä»€ä¹ˆçš„å°±è¡Œå•¦ï¼</p>
<hr>
<h1 id="çœç•¥-initState"><a href="#çœç•¥-initState" class="headerlink" title="çœç•¥ initState"></a>çœç•¥ initState</h1><p>æœ‰æ—¶å€™æˆ‘ä»¬åˆ›å»º store çš„æ—¶å€™ä¸ä¼  initStateï¼Œæˆ‘ä»¬æ€ä¹ˆç”¨ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer, &#123;&#125;, rewriteCreateStoreFunc);</span><br></pre></td></tr></table></figure>

<p>redux å…è®¸æˆ‘ä»¬è¿™æ ·å†™</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer, rewriteCreateStoreFunc);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»…éœ€è¦æ”¹ä¸‹ createStore å‡½æ•°ï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªobjectï¼Œæˆ‘ä»¬è®¤ä¸ºä»–æ˜¯ initStateï¼Œå¦‚æœæ˜¯ functionï¼Œæˆ‘ä»¬å°±è®¤ä¸ºä»–æ˜¯ rewriteCreateStoreFuncã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">craeteStore</span>(<span class="params">reducer, initState, rewriteCreateStoreFunc</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> initState === <span class="string">'function'</span>)&#123;</span><br><span class="line">    rewriteCreateStoreFunc = initState;</span><br><span class="line">    initState = <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="2-è¡Œä»£ç çš„-replaceReducer"><a href="#2-è¡Œä»£ç çš„-replaceReducer" class="headerlink" title="2 è¡Œä»£ç çš„ replaceReducer"></a>2 è¡Œä»£ç çš„ replaceReducer</h1><p>reducer æ‹†åˆ†åï¼Œå’Œç»„ä»¶æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æˆ‘ä»¬å°±å¸Œæœ›åœ¨åšæŒ‰éœ€åŠ è½½çš„æ—¶å€™ï¼Œreducerä¹Ÿå¯ä»¥è·Ÿç€ç»„ä»¶åœ¨å¿…è¦çš„æ—¶å€™å†åŠ è½½ï¼Œç„¶åç”¨æ–°çš„ reducer æ›¿æ¢è€çš„ reducerã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = <span class="function"><span class="keyword">function</span> (<span class="params">reducer, initState</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">replaceReducer</span>(<span class="params">nextReducer</span>) </span>&#123;</span><br><span class="line">    reducer = nextReducer</span><br><span class="line">    <span class="comment">/*åˆ·æ–°ä¸€é state çš„å€¼ï¼Œæ–°æ¥çš„ reducer æŠŠè‡ªå·±çš„é»˜è®¤çŠ¶æ€æ”¾åˆ° state æ ‘ä¸Šå»*/</span></span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="built_in">Symbol</span>() &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    replaceReducer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥å°è¯•ä½¿ç”¨ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç”Ÿæˆæ–°çš„reducer*/</span></span><br><span class="line"><span class="keyword">const</span> nextReducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">  info: infoReducer</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*replaceReducer*/</span></span><br><span class="line">store.replaceReducer(nextReducer);</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="bindActionCreators"><a href="#bindActionCreators" class="headerlink" title="bindActionCreators"></a>bindActionCreators</h1><p>bindActionCreators æˆ‘ä»¬å¾ˆå°‘å¾ˆå°‘ç”¨åˆ°ï¼Œä¸€èˆ¬åªæœ‰åœ¨ react-redux çš„ connect å®ç°ä¸­ç”¨åˆ°ã€‚</p>
<p>ä»–æ˜¯åšä»€ä¹ˆçš„ï¼Ÿä»–é€šè¿‡é—­åŒ…ï¼ŒæŠŠ dispatch å’Œ actionCreator éšè—èµ·æ¥ï¼Œè®©å…¶ä»–åœ°æ–¹æ„ŸçŸ¥ä¸åˆ° redux çš„å­˜åœ¨ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡æ™®é€šçš„æ–¹å¼æ¥ éšè— dispatch å’Œ actionCreator è¯•è¯•ï¼Œæ³¨æ„æœ€åä¸¤è¡Œä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">  info: infoReducer</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è¿”å› action çš„å‡½æ•°å°±å« actionCreator*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'INCREMENT'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setName</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'SET_NAME'</span>,</span><br><span class="line">    name: name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  increment: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> store.dispatch(increment.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;,</span><br><span class="line">  setName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> store.dispatch(setName.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*æ³¨æ„ï¼šæˆ‘ä»¬å¯ä»¥æŠŠ actions ä¼ åˆ°ä»»ä½•åœ°æ–¹å»*/</span></span><br><span class="line"><span class="comment">/*å…¶ä»–åœ°æ–¹åœ¨å®ç°è‡ªå¢çš„æ—¶å€™ï¼Œæ ¹æœ¬ä¸çŸ¥é“ dispatchï¼ŒactionCreatorç­‰ç»†èŠ‚*/</span></span><br><span class="line">actions.increment(); <span class="comment">/*è‡ªå¢*/</span></span><br><span class="line">actions.setName(<span class="string">'ä¹éƒ¨å¨æ­¦'</span>); <span class="comment">/*ä¿®æ”¹ info.name*/</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘çœ¼ç›ä¸€çœ‹ï¼Œè¿™ä¸ª actions ç”Ÿæˆçš„æ—¶å€™ï¼Œå¥½å¤šå…¬å…±ä»£ç ï¼Œæå–ä¸€ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = bindActionCreators(&#123; increment, setName &#125;, store.dispatch);</span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹ä¸€ä¸‹ bindActionCreators çš„æºç ï¼Œè¶…çº§ç®€å•ï¼ˆå°±æ˜¯ç”Ÿæˆäº†åˆšæ‰çš„ actionsï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ ¸å¿ƒçš„ä»£ç åœ¨è¿™é‡Œï¼Œé€šè¿‡é—­åŒ…éšè—äº† actionCreator å’Œ dispatch*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dispatch(actionCreator.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* actionCreators å¿…é¡»æ˜¯ function æˆ–è€… object */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreators, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> bindActionCreator(actionCreators, dispatch)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators !== <span class="string">'object'</span> || actionCreators === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(actionCreators)</span><br><span class="line">  <span class="keyword">const</span> boundActionCreators = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="keyword">const</span> actionCreator = actionCreators[key]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator === <span class="string">'function'</span>) &#123;</span><br><span class="line">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> boundActionCreators</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="å¤§åŠŸå‘Šæˆ"><a href="#å¤§åŠŸå‘Šæˆ" class="headerlink" title="å¤§åŠŸå‘Šæˆ"></a>å¤§åŠŸå‘Šæˆ</h1><p>å®Œæ•´çš„ç¤ºä¾‹æºç è§ <a href="https://github.com/frontend9/redux-demo/tree/master/demo-9" target="_blank" rel="noopener">demo-9</a>ï¼Œä½ å¯ä»¥å’Œ <a href="https://github.com/reduxjs/redux" target="_blank" rel="noopener">redux</a> æºç åšä¸€ä¸‹å¯¹æ¯”ï¼Œä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº† redux æ‰€æœ‰çš„åŠŸèƒ½äº†ã€‚</p>
<p>å½“ç„¶ï¼Œä¸ºäº†ä¿è¯ä»£ç çš„å¯ç†è§£æ€§ï¼Œæˆ‘ä»¬å°‘äº†ä¸€äº›å‚æ•°éªŒè¯ã€‚æ¯”å¦‚ <code>createStore(reducer)</code>çš„å‚æ•° reducer å¿…é¡»æ˜¯ function ç­‰ç­‰ã€‚</p>
<hr>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆ°äº†æœ€åï¼Œæˆ‘æƒ³æŠŠ redux ä¸­å…³é”®çš„åè¯åˆ—å‡ºæ¥ï¼Œä½ æ¯ä¸ªéƒ½çŸ¥é“æ˜¯å¹²å•¥çš„å—ï¼Ÿ</p>
<ul>
<li><p>createStore</p>
<p>åˆ›å»º store å¯¹è±¡ï¼ŒåŒ…å« getState, dispatch, subscribe, replaceReducer</p>
</li>
</ul>
<ul>
<li><p>reducer</p>
<p>reducer æ˜¯ä¸€ä¸ªè®¡åˆ’å‡½æ•°ï¼Œæ¥æ”¶æ—§çš„ state å’Œ actionï¼Œç”Ÿæˆæ–°çš„ state</p>
</li>
</ul>
<ul>
<li><p>action</p>
<p>action æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åŒ…å« type å­—æ®µ</p>
</li>
</ul>
<ul>
<li><p>dispatch</p>
<p><code>dispatch( action )</code>  è§¦å‘ actionï¼Œç”Ÿæˆæ–°çš„ state</p>
</li>
</ul>
<ul>
<li><p>subscribe</p>
<p>å®ç°è®¢é˜…åŠŸèƒ½ï¼Œæ¯æ¬¡è§¦å‘ dispatch çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œè®¢é˜…å‡½æ•°</p>
</li>
</ul>
<ul>
<li><p>combineReducers</p>
<p>å¤š reducer åˆå¹¶æˆä¸€ä¸ª reducer</p>
</li>
</ul>
<ul>
<li><p>replaceReducer</p>
<p>æ›¿æ¢ reducer å‡½æ•°</p>
</li>
</ul>
<ul>
<li><p>middleware</p>
<p>æ‰©å±• dispatch å‡½æ•°ï¼</p>
</li>
</ul>
<p>ä½ å†çœ‹ redux æµç¨‹å›¾ï¼Œæ˜¯ä¸æ˜¯å¤§å½»å¤§æ‚Ÿäº†ï¼Ÿ</p>
<p><img src="https://cdn.nlark.com/yuque/0/2018/png/189350/1541937499061-993cb988-010f-4419-b23e-7482985a66f5.png" alt="redux æµç¨‹å›¾"></p>
<p>(redux æµç¨‹å›¾)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/28/redux/" data-id="cjwg1k5em00017hqd384c6uov" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/06/03/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/03/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/04/28/redux/">redux</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 yufanglong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>